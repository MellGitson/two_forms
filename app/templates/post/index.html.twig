{% extends 'base.html.twig' %}

{% block title %}Tous les Articles{% endblock %}

{% block body %}
<div class="container">
    <a href="{{ path('app_home') }}" class="btn-back">‚Üê Retour</a>
    
    <div class="posts-header">
        <h1>üìö Tous les Articles</h1>
        <span class="posts-count">{{ posts|length }} article(s)</span>
    </div>

    {% if is_granted('ROLE_ADMIN') %}
        <div class="admin-actions">
            <a href="{{ path('app_post_new') }}" class="btn btn-cyan">‚ûï Cr√©er un article</a>
            <a href="{{ path('app_category_index') }}" class="btn btn-secondary">üè∑Ô∏è G√©rer les cat√©gories</a>
        </div>
    {% endif %}

    {% if posts is not empty %}
        <div class="posts-grid">
            {% for post in posts %}
                <div class="post-card">
                    {% if post.imagePath %}
                        <div class="post-image">
                            <img src="{{ asset('uploads/posts/' ~ post.imagePath) }}" alt="{{ post.title }}">
                        </div>
                    {% else %}
                        <div class="post-image placeholder">
                            üìÑ
                        </div>
                    {% endif %}

                    <div class="post-content">
                        <div class="post-meta">
                            <span class="post-category">{{ post.category.name }}</span>
                            <span class="post-date">{{ post.createdAt|date('d/m/Y') }}</span>
                        </div>

                        <h2 class="post-title">{{ post.title }}</h2>

                        <p class="post-excerpt">
                            {{ post.content|slice(0, 120)|striptags }}{% if post.content|length > 120 %}...{% endif %}
                        </p>

                        <div class="post-actions">
                            <a href="{{ path('app_post_show', {'id': post.id}) }}" class="btn-action btn-view">üëÅÔ∏è Voir</a>
                            {% if is_granted('ROLE_ADMIN') %}
                                <a href="{{ path('app_post_edit', {'id': post.id}) }}" class="btn-action btn-edit">‚úèÔ∏è √âditer</a>
                                <form method="post" action="{{ path('app_post_delete', {'id': post.id}) }}" class="delete-form">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                                    <button type="submit" class="btn-action btn-delete" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cet article ?')">üóëÔ∏è Supprimer</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h2>üì≠ Aucun article trouv√©</h2>
            <p>Il n'y a pas encore d'articles. Cr√©ez-en un pour commencer !</p>
            {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ path('app_post_new') }}" class="btn btn-cyan">‚ûï Cr√©er un article</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px 20px;
    }

    .btn-back {
        display: inline-block;
        color: #00d9ff;
        text-decoration: none;
        margin-bottom: 20px;
        font-size: 1em;
        transition: color 0.3s;
    }

    .btn-back:hover {
        color: #00f0ff;
        text-decoration: underline;
    }

    .posts-header {
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    .posts-header h1 {
        font-size: 2.5em;
        color: #00d9ff;
        margin: 0;
        text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
    }

    .posts-count {
        background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
        color: #0a0e27;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.9em;
        box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
    }

    .admin-actions {
        display: flex;
        gap: 15px;
        margin-bottom: 40px;
        flex-wrap: wrap;
    }

    .btn {
        display: inline-block;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 600;
        transition: all 0.3s;
        text-align: center;
    }

    .btn-cyan {
        background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
        color: #0a0e27;
        box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
    }

    .btn-cyan:hover {
        box-shadow: 0 0 25px rgba(0, 217, 255, 0.5);
        transform: translateY(-2px);
    }

    .btn-secondary {
        background: rgba(0, 217, 255, 0.1);
        color: #00d9ff;
        border: 2px solid #00d9ff;
    }

    .btn-secondary:hover {
        background: rgba(0, 217, 255, 0.2);
        box-shadow: 0 0 15px rgba(0, 217, 255, 0.2);
    }

    .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    .post-card {
        background: linear-gradient(135deg, rgba(10, 14, 39, 0.8) 0%, rgba(15, 25, 50, 0.9) 100%);
        border: 2px solid #00d9ff;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s;
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 20px rgba(0, 217, 255, 0.1), inset 0 0 10px rgba(0, 217, 255, 0.05);
    }

    .post-card:hover {
        border-color: #00f0ff;
        box-shadow: 0 0 30px rgba(0, 217, 255, 0.3), inset 0 0 15px rgba(0, 217, 255, 0.1);
        transform: translateY(-5px);
    }

    .post-image {
        width: 100%;
        height: 200px;
        overflow: hidden;
        border-bottom: 2px solid #00d9ff;
    }

    .post-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .post-card:hover .post-image img {
        transform: scale(1.05);
    }

    .post-image.placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 153, 204, 0.1) 100%);
        font-size: 4em;
    }

    .post-content {
        padding: 20px;
        display: flex;
        flex-direction: column;
        flex: 1;
    }

    .post-meta {
        display: flex;
        gap: 10px;
        margin-bottom: 12px;
        flex-wrap: wrap;
        align-items: center;
    }

    .post-category {
        background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
        color: #0a0e27;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);
    }

    .post-date {
        color: #00d9ff;
        font-size: 0.85em;
        font-weight: 600;
    }

    .post-title {
        font-size: 1.3em;
        color: #ffffff;
        margin: 0 0 12px 0;
        line-height: 1.4;
        min-height: 2.6em;
    }

    .post-excerpt {
        color: #b0b8d0;
        font-size: 0.9em;
        line-height: 1.5;
        margin: 0 0 15px 0;
        flex: 1;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .post-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .btn-action {
        flex: 1;
        min-width: 80px;
        padding: 8px 12px;
        text-decoration: none;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 0.85em;
        font-weight: 600;
        transition: all 0.3s;
        text-align: center;
    }

    .btn-view {
        background: linear-gradient(135deg, #00d9ff 0%, #0099cc 100%);
        color: #0a0e27;
        box-shadow: 0 0 10px rgba(0, 217, 255, 0.2);
    }

    .btn-view:hover {
        box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
        transform: scale(1.05);
    }

    .btn-edit {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
        border: 1px solid #ffc107;
    }

    .btn-edit:hover {
        background: rgba(255, 193, 7, 0.3);
        box-shadow: 0 0 10px rgba(255, 193, 7, 0.2);
    }

    .btn-delete {
        background: rgba(220, 53, 69, 0.2);
        color: #ff6b6b;
        border: 1px solid #ff6b6b;
    }

    .btn-delete:hover {
        background: rgba(220, 53, 69, 0.3);
        box-shadow: 0 0 10px rgba(220, 53, 69, 0.2);
    }

    .delete-form {
        flex: 1;
        min-width: 80px;
    }

    .delete-form .btn-delete {
        width: 100%;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-state h2 {
        color: #00d9ff;
        font-size: 1.8em;
        margin-bottom: 15px;
    }

    .empty-state p {
        color: #b0b8d0;
        font-size: 1.05em;
        margin-bottom: 30px;
    }

    @media (max-width: 768px) {
        .posts-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .posts-header h1 {
            font-size: 1.8em;
        }

        .posts-grid {
            grid-template-columns: 1fr;
        }

        .post-actions {
            flex-direction: column;
        }

        .btn-action {
            width: 100%;
        }

        .admin-actions {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}
