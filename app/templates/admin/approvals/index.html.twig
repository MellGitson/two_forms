{% extends 'base.html.twig' %}

{% block title %}Panel d'Approbations{% endblock %}

{% block body %}
<div class="container">
    <h1>Panel d'Approbations</h1>
    
    {% if app.flashes %}
        {% for label, messages in app.flashes %}
            <div class="alert alert-{{ label }}">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endfor %}
    {% endif %}

    <div class="approvals">
        <!-- Pending Posts -->
        <section class="approval-section">
            <h2>Posts en attente ({{ pending_posts|length }})</h2>
            {% if pending_posts %}
                <div class="items-list">
                    {% for post in pending_posts %}
                        <div class="item-card">
                            <h3>{{ post.title }}</h3>
                            <p><small>Par: (ID {{ post.id }}) | Catégorie: {{ post.category.name }}</small></p>
                            <p class="content">{{ post.content[:100] }}...</p>
                            <div class="actions">
                                <form action="{{ path('app_admin_approvals_post_approve', {'id': post.id}) }}" method="post" style="display: inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('approve_post' ~ post.id) }}">
                                    <button type="submit" class="btn btn-success">Approuver</button>
                                </form>
                                <form action="{{ path('app_admin_approvals_post_reject', {'id': post.id}) }}" method="post" style="display: inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('reject_post' ~ post.id) }}">
                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Êtes-vous sûr?')">Rejeter</button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-state">Aucun post en attente</p>
            {% endif %}
        </section>

        <!-- Pending Comments -->
        <section class="approval-section">
            <h2>Commentaires en attente ({{ pending_comments|length }})</h2>
            {% if pending_comments %}
                <div class="items-list">
                    {% for comment in pending_comments %}
                        <div class="item-card">
                            <p><small>Sur le post: {{ comment.post.title }} | Par utilisateur (ID {{ comment.author.id }})</small></p>
                            <p class="content">{{ comment.content[:100] }}...</p>
                            <div class="actions">
                                <form action="{{ path('app_admin_approvals_comment_approve', {'id': comment.id}) }}" method="post" style="display: inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('approve_comment' ~ comment.id) }}">
                                    <button type="submit" class="btn btn-success">Approuver</button>
                                </form>
                                <form action="{{ path('app_admin_approvals_comment_reject', {'id': comment.id}) }}" method="post" style="display: inline;">
                                    <input type="hidden" name="_token" value="{{ csrf_token('reject_comment' ~ comment.id) }}">
                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Êtes-vous sûr?')">Rejeter</button>
                                </form>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-state">Aucun commentaire en attente</p>
            {% endif %}
        </section>

        <!-- Approved Posts -->
        <section class="approval-section">
            <h2>Posts approuvés ({{ approved_posts|length }})</h2>
            {% if approved_posts %}
                <div class="items-list approved">
                    {% for post in approved_posts %}
                        <div class="item-card">
                            <p><strong>{{ post.title }}</strong> <span class="badge-success">✓</span></p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-state">Aucun post approuvé</p>
            {% endif %}
        </section>

        <!-- Approved Comments -->
        <section class="approval-section">
            <h2>Commentaires approuvés ({{ approved_comments|length }})</h2>
            {% if approved_comments %}
                <div class="items-list approved">
                    {% for comment in approved_comments %}
                        <div class="item-card">
                            <p><strong>Sur:</strong> {{ comment.post.title }} <span class="badge-success">✓</span></p>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-state">Aucun commentaire approuvé</p>
            {% endif %}
        </section>
    </div>

    <div class="actions">
        <a href="{{ path('app_home') }}" class="btn btn-secondary">Retour</a>
    </div>
</div>

<style>
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif; }
    h1 { color: #333; }
    h2 { color: #555; margin-top: 30px; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    
    .approval-section { margin: 30px 0; }
    .items-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
    .item-card { background: #f9f9f9; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }
    .item-card h3 { margin-top: 0; margin-bottom: 10px; font-size: 1.1em; }
    .item-card.approved { border-left-color: #28a745; }
    .content { color: #666; font-size: 0.9em; }
    .actions { margin-top: 10px; }
    .btn { display: inline-block; padding: 8px 15px; margin-right: 5px; text-decoration: none; border-radius: 4px; border: none; cursor: pointer; font-size: 0.9em; }
    .btn-success { background-color: #28a745; color: white; }
    .btn-danger { background-color: #dc3545; color: white; }
    .btn-secondary { background-color: #6c757d; color: white; }
    .btn:hover { opacity: 0.8; }
    .empty-state { color: #999; font-style: italic; padding: 20px; }
    .badge-success { display: inline-block; background-color: #28a745; color: white; padding: 2px 8px; border-radius: 3px; margin-left: 10px; font-weight: bold; }
    .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
</style>
{% endblock %}
